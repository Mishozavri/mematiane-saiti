<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>áƒ“áƒáƒ•áƒ˜áƒ— áƒáƒ¦áƒ›áƒáƒ¨áƒ”áƒœáƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ”áƒ áƒ—áƒ”áƒ‘áƒ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@100..900&family=Noto+Serif+Georgian:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- Marked for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Application Styles -->
    <style>
        /* Base Typography */
        body {
            font-family: 'Noto Sans Georgian', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
            color: #1c1917; /* stone-900 */
        }
        
        h1, h2, h3, .serif-font {
            font-family: 'Noto Serif Georgian', serif;
        }

        /* Chart Container Strict Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Scrollbar for Chronicle Section */
        .parchment-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .parchment-scroll::-webkit-scrollbar-track {
            background: #fde68a; 
        }
        .parchment-scroll::-webkit-scrollbar-thumb {
            background: #b45309; 
            border-radius: 4px;
        }

        /* Timeline Active State */
        .timeline-dot.active {
            background-color: #b45309; /* amber-700 */
            border-color: #78350f; /* amber-900 */
            transform: scale(1.25);
        }

        /* Chat Modal Transitions */
        .chat-enter {
            transform: translateY(100%);
            opacity: 0;
        }
        .chat-enter-active {
            transform: translateY(0);
            opacity: 1;
            transition: all 300ms ease-out;
        }
        .chat-exit {
            transform: translateY(0);
            opacity: 1;
        }
        .chat-exit-active {
            transform: translateY(100%);
            opacity: 0;
            transition: all 300ms ease-in;
        }
        
        /* Loading Sparkle Animation */
        @keyframes sparkle {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .sparkle-anim {
            animation: sparkle 1.5s infinite;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col relative">

    <!-- Navigation -->
    <nav class="bg-stone-900 text-amber-50 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl">ğŸ‘‘</span>
                    <span class="font-bold text-lg tracking-wider">áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ£áƒšáƒ˜ áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”</span>
                </div>
                <div class="hidden md:flex space-x-8 text-sm font-medium">
                    <a href="#intro" class="hover:text-amber-400 transition">áƒ¨áƒ”áƒ¡áƒáƒ•áƒáƒšáƒ˜</a>
                    <a href="#chronicle" class="hover:text-amber-400 transition">áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”</a>
                    <a href="#analysis" class="hover:text-amber-400 transition">áƒáƒœáƒáƒšáƒ˜áƒ–áƒ˜</a>
                    <a href="#significance" class="hover:text-amber-400 transition">áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header id="intro" class="bg-stone-800 text-stone-100 py-16 px-4 text-center border-b-4 border-amber-700">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-5xl font-bold mb-6 text-amber-500">áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ áƒ“áƒ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ’áƒáƒ”áƒ áƒ—áƒ˜áƒáƒœáƒ”áƒ‘áƒ</h1>
            <p class="text-lg md:text-xl text-stone-300 mb-8 leading-relaxed">
                áƒ˜áƒœáƒ¢áƒ”áƒ áƒáƒ¥áƒªáƒ˜áƒ£áƒšáƒ˜ áƒ›áƒáƒ’áƒ–áƒáƒ£áƒ áƒáƒ‘áƒ áƒ“áƒáƒ•áƒ˜áƒ— IV áƒáƒ¦áƒ›áƒáƒ¨áƒ”áƒœáƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ”áƒáƒáƒ¥áƒáƒ¨áƒ˜. áƒ’áƒáƒ›áƒáƒ˜áƒ™áƒ•áƒšáƒ˜áƒ”áƒ— áƒ áƒáƒ’áƒáƒ  áƒ“áƒáƒ£áƒ‘áƒ áƒ£áƒœáƒ“áƒ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡, áƒ áƒ áƒ¡áƒ¢áƒ áƒáƒ¢áƒ”áƒ’áƒ˜áƒ˜áƒ— áƒ›áƒ˜áƒáƒ¦áƒ¬áƒ˜áƒ áƒ›áƒ”áƒ¤áƒ”áƒ› áƒ’áƒáƒ›áƒáƒ áƒ¯áƒ•áƒ”áƒ‘áƒáƒ¡ áƒ“áƒ áƒ áƒ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ áƒ°áƒ¥áƒáƒœáƒ“áƒ áƒáƒ› áƒ›áƒáƒ•áƒšáƒ”áƒœáƒáƒ¡ áƒ¥áƒ•áƒ”áƒ§áƒœáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.
            </p>
            <div class="flex justify-center gap-4">
                <button onclick="document.getElementById('chronicle').scrollIntoView({behavior: 'smooth'})" class="bg-amber-700 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition transform hover:-translate-y-1">
                    ğŸ“– áƒ¬áƒáƒ˜áƒ™áƒ˜áƒ—áƒ®áƒ” áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”
                </button>
                <button onclick="document.getElementById('timeline-section').scrollIntoView({behavior: 'smooth'})" class="bg-stone-600 hover:bg-stone-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition transform hover:-translate-y-1">
                    â³ áƒ˜áƒ®áƒ˜áƒšáƒ” áƒ¥áƒ áƒáƒœáƒáƒšáƒáƒ’áƒ˜áƒ
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-20">

        <!-- 1. Chronology Section (Context) -->
        <section id="timeline-section" class="scroll-mt-24">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-stone-800 mb-4">ğŸ“œ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ£áƒšáƒ˜ áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒ“áƒ áƒ¥áƒ áƒáƒœáƒáƒšáƒáƒ’áƒ˜áƒ</h2>
                <p class="text-stone-600 max-w-2xl mx-auto">
                    áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ”áƒ áƒ—áƒ”áƒ‘áƒ áƒáƒ  áƒ§áƒáƒ¤áƒ˜áƒšáƒ áƒ˜áƒ–áƒáƒšáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ›áƒáƒ•áƒšáƒ”áƒœáƒ. áƒ˜áƒ¡ áƒ“áƒáƒ•áƒ˜áƒ— áƒáƒ¦áƒ›áƒáƒ¨áƒ”áƒœáƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ—áƒáƒœáƒ›áƒ˜áƒ›áƒ“áƒ”áƒ•áƒ áƒ£áƒšáƒ˜ áƒáƒáƒšáƒ˜áƒ¢áƒ˜áƒ™áƒ˜áƒ¡ áƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜ áƒ˜áƒ§áƒ.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-8 items-start">
                <!-- Timeline Navigation -->
                <div class="md:col-span-4 relative pl-4 border-l-4 border-stone-300 space-y-8" id="timeline-nav">
                    <!-- Items generated by JS -->
                </div>

                <!-- Timeline Details Panel -->
                <div class="md:col-span-8 bg-white p-8 rounded-xl shadow-lg border-t-4 border-amber-600 min-h-[300px] flex flex-col justify-center transition-all duration-300" id="timeline-content-panel">
                    <h3 class="text-2xl font-bold text-amber-800 mb-4" id="tl-title">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ›áƒáƒ•áƒšáƒ”áƒœáƒ</h3>
                    <p class="text-lg text-stone-700 leading-relaxed" id="tl-desc">
                        áƒ“áƒáƒáƒ¬áƒ™áƒáƒáƒ£áƒœáƒ”áƒ— áƒ›áƒáƒ áƒªáƒ®áƒœáƒ˜áƒ• áƒ›áƒáƒªáƒ”áƒ›áƒ£áƒš áƒ¬áƒšáƒ”áƒ‘áƒ–áƒ”, áƒ áƒáƒ—áƒ áƒ’áƒáƒ˜áƒ’áƒáƒ—, áƒ áƒáƒ’áƒáƒ  áƒ›áƒ˜áƒ’áƒ•áƒ˜áƒ§áƒ•áƒáƒœáƒ áƒ—áƒ˜áƒ—áƒáƒ”áƒ£áƒšáƒ›áƒ áƒœáƒáƒ‘áƒ˜áƒ¯áƒ›áƒ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒšáƒ”áƒ‘áƒáƒ›áƒ“áƒ”.
                    </p>
                    <div class="mt-6 flex items-center text-stone-500 text-sm">
                        <span class="mr-2 text-xl">ğŸ’¡</span>
                        <span id="tl-insight">áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ£áƒšáƒ˜ áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. The Chronicle (Creative Part) with AI Writer -->
        <section id="chronicle" class="bg-amber-50 rounded-lg overflow-hidden shadow-inner border border-amber-200 scroll-mt-24">
            <div class="grid grid-cols-1 lg:grid-cols-2">
                <!-- The "Book" Side -->
                <div class="p-8 lg:p-12 bg-[#fffbeb] relative">
                    <div class="absolute top-4 left-4 text-4xl opacity-10">ğŸ–‹ï¸</div>
                    <h2 class="text-3xl serif-font font-bold text-amber-900 mb-6 border-b-2 border-amber-200 pb-2">
                        áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ” â€áƒ«áƒšáƒ”áƒ•áƒáƒ˜ áƒ¡áƒáƒ™áƒ•áƒ˜áƒ áƒ•áƒ”áƒšáƒ˜â€œ
                    </h2>
                    
                    <div class="h-80 overflow-y-auto parchment-scroll pr-4 text-lg leading-loose text-stone-800 serif-font text-justify mb-8" id="chronicle-text">
                        <!-- Chronicle text injected by JS -->
                    </div>

                    <!-- AI Feature 1: Chronicle Writer -->
                    <div class="bg-amber-100 p-4 rounded-lg border border-amber-300 mt-4">
                        <h4 class="text-amber-800 font-bold mb-2 flex items-center gap-2">
                            <span>âœ¨</span> áƒ’áƒáƒáƒ’áƒ áƒ«áƒ”áƒšáƒ” áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”
                        </h4>
                        <p class="text-xs text-amber-700 mb-2">áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ“áƒáƒ¡áƒáƒ¬áƒ§áƒ˜áƒ¡áƒ˜ áƒ“áƒ áƒ®áƒ”áƒšáƒáƒ•áƒœáƒ£áƒ áƒ˜ áƒ˜áƒœáƒ¢áƒ”áƒšáƒ”áƒ¥áƒ¢áƒ˜ áƒ’áƒáƒáƒ’áƒ áƒ«áƒ”áƒšáƒ”áƒ‘áƒ¡ áƒ›áƒ”áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ˜áƒ¡ áƒ¡áƒ¢áƒ˜áƒšáƒ¨áƒ˜:</p>
                        <textarea id="chronicle-input" class="w-full p-2 rounded bg-white border border-amber-200 text-stone-800 text-sm focus:ring-2 focus:ring-amber-500 outline-none mb-2" rows="2" placeholder="áƒ›áƒáƒ’: áƒ“áƒ áƒ¨áƒ”áƒ™áƒ áƒ˜áƒ‘áƒ áƒ›áƒ”áƒ¤áƒ”áƒ›áƒáƒœ áƒ“áƒ˜áƒ“áƒ”áƒ‘áƒ£áƒšáƒœáƒ˜..."></textarea>
                        <button onclick="generateChronicle()" id="chronicle-btn" class="w-full bg-amber-600 hover:bg-amber-700 text-white text-sm font-bold py-2 px-4 rounded transition flex justify-center items-center gap-2">
                            <span>âœï¸</span> áƒ¨áƒ”áƒ—áƒ®áƒ–áƒ” áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”
                        </button>
                        <div id="chronicle-output" class="mt-3 text-sm text-stone-800 italic hidden p-2 bg-white rounded border-l-2 border-amber-500"></div>
                    </div>
                </div>
                
                <!-- The Visual/Context Side -->
                <div class="bg-stone-800 p-8 lg:p-12 flex flex-col justify-center text-stone-200">
                    <h3 class="text-2xl font-bold mb-4 text-amber-400">áƒ¨áƒ”áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ áƒ”áƒ¤áƒšáƒ”áƒ¥áƒ¡áƒ˜áƒ</h3>
                    <p class="mb-6 leading-relaxed">
                        áƒ”áƒ¡ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒ¡áƒ¢áƒ˜áƒšáƒ˜áƒ–áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ XI-XII áƒ¡áƒáƒ£áƒ™áƒ£áƒœáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ¡áƒáƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ áƒáƒ áƒáƒ–áƒ˜áƒ¡ áƒ›áƒ˜áƒ®áƒ”áƒ“áƒ•áƒ˜áƒ—. áƒ›áƒáƒ¡áƒ¨áƒ˜ áƒ®áƒáƒ–áƒ’áƒáƒ¡áƒ›áƒ£áƒšáƒ˜áƒ:
                    </p>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-start">
                            <span class="text-amber-500 mr-2">âœ¦</span>
                            <span><strong>áƒ¦áƒ•áƒ—áƒ˜áƒ£áƒ áƒ˜ áƒœáƒ”áƒ‘áƒ:</strong> áƒ’áƒáƒ›áƒáƒ áƒ¯áƒ•áƒ”áƒ‘áƒ áƒáƒ¦áƒ¥áƒ›áƒ£áƒšáƒ˜áƒ áƒ áƒáƒ’áƒáƒ áƒª áƒ¦áƒ•áƒ—áƒ˜áƒ¡ áƒ¬áƒ§áƒáƒšáƒáƒ‘áƒ.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-amber-500 mr-2">âœ¦</span>
                            <span><strong>áƒ›áƒ”áƒ¤áƒ˜áƒ¡ áƒ¡áƒ˜áƒ‘áƒ áƒ«áƒœáƒ”:</strong> áƒ“áƒáƒ•áƒ˜áƒ—áƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ“áƒ’áƒ”áƒœáƒ˜áƒšáƒ˜áƒ áƒ áƒáƒ’áƒáƒ áƒª â€áƒ®áƒ£áƒ áƒáƒ—áƒ›áƒáƒ«áƒ¦áƒ•áƒáƒ áƒ˜â€œ.</span>
                        </li>
                    </ul>
                    <div class="mt-auto pt-4 border-t border-stone-600 text-sm text-stone-400">
                        * áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ— "áƒ’áƒáƒáƒ’áƒ áƒ«áƒ”áƒšáƒ” áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”" áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ“áƒáƒ•áƒáƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒœáƒáƒ¬áƒ˜áƒšáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Analytical Section (Charts) -->
        <section id="analysis" class="scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-stone-800 mb-4">ğŸ“Š áƒ¡áƒ¢áƒ áƒáƒ¢áƒ”áƒ’áƒ˜áƒ£áƒšáƒ˜ áƒáƒœáƒáƒšáƒ˜áƒ–áƒ˜</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <!-- Chart 1: Military Composition -->
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="text-xl font-bold text-stone-800 mb-2">áƒ¡áƒáƒ›áƒ®áƒ”áƒ“áƒ áƒ áƒ áƒ”áƒ¤áƒáƒ áƒ›áƒ</h3>
                        <div class="chart-container">
                            <canvas id="armyChart"></canvas>
                        </div>
                    </div>
                    <!-- Chart 2: Strategic Balance -->
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="text-xl font-bold text-stone-800 mb-2">áƒ“áƒ˜áƒ“áƒ’áƒáƒ áƒ˜áƒ¡ áƒ”áƒ¤áƒ”áƒ¥áƒ¢áƒ˜ (1121 áƒ¬.)</h3>
                        <div class="chart-container">
                            <canvas id="battleChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Significance Cards -->
        <section id="significance" class="scroll-mt-24 mb-16">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-stone-800 mb-4">ğŸŒŸ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-emerald-500">
                        <div class="text-4xl mb-4">ğŸ—ºï¸</div>
                        <h3 class="font-bold text-lg mb-2">áƒ’áƒáƒ”áƒ áƒ—áƒ˜áƒáƒœáƒ”áƒ‘áƒ</h3>
                        <p class="text-sm text-stone-600">áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ "áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ›áƒ˜áƒ¬áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ™áƒ áƒ”áƒ‘áƒ˜áƒ¡" áƒáƒ áƒáƒªáƒ”áƒ¡áƒ˜.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-amber-500">
                        <div class="text-4xl mb-4">ğŸ›ï¸</div>
                        <h3 class="font-bold text-lg mb-2">áƒáƒ®áƒáƒšáƒ˜ áƒ“áƒ”áƒ“áƒáƒ¥áƒáƒšáƒáƒ¥áƒ˜</h3>
                        <p class="text-sm text-stone-600">áƒªáƒ”áƒœáƒ¢áƒ áƒ›áƒ áƒ’áƒáƒ“áƒáƒ˜áƒœáƒáƒªáƒ•áƒšáƒ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ¨áƒ˜.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-500">
                        <div class="text-4xl mb-4">ğŸ’°</div>
                        <h3 class="font-bold text-lg mb-2">áƒ”áƒ™áƒáƒœáƒáƒ›áƒ˜áƒ™áƒ</h3>
                        <p class="text-sm text-stone-600">áƒ™áƒáƒœáƒ¢áƒ áƒáƒšáƒ˜ áƒ¡áƒáƒ•áƒáƒ­áƒ áƒ áƒ’áƒ–áƒ”áƒ‘áƒ–áƒ”.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-purple-500">
                        <div class="text-4xl mb-4">ğŸ¤</div>
                        <h3 class="font-bold text-lg mb-2">áƒ¢áƒáƒšáƒ”áƒ áƒáƒœáƒ¢áƒáƒ‘áƒ</h3>
                        <p class="text-sm text-stone-600">áƒ áƒ¯áƒ£áƒšáƒ˜áƒ¡ áƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ.</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-8 text-center border-t border-stone-800">
        <p class="text-sm">áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜áƒ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ˜áƒ¡ áƒ™áƒáƒ›áƒáƒšáƒ”áƒ¥áƒ¡áƒ£áƒ áƒ˜ áƒ“áƒáƒ•áƒáƒšáƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡</p>
    </footer>

    <!-- AI Feature 2: Floating Chat Widget -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
        
        <!-- Chat Modal -->
        <div id="chat-modal" class="hidden mb-4 w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-stone-200 overflow-hidden flex flex-col transition-all duration-300 transform origin-bottom-right" style="height: 450px;">
            <!-- Header -->
            <div class="bg-stone-900 p-4 flex justify-between items-center text-amber-50">
                <div class="flex items-center gap-2">
                    <span class="text-xl">ğŸ“œ</span>
                    <span class="font-bold">áƒ°áƒ™áƒ˜áƒ—áƒ®áƒ” áƒ›áƒ”áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”áƒ¡</span>
                </div>
                <button onclick="toggleChat()" class="text-stone-400 hover:text-white">&times;</button>
            </div>
            
            <!-- Messages Area -->
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto bg-stone-50 space-y-4 text-sm">
                <div class="flex gap-2">
                    <div class="w-8 h-8 rounded-full bg-amber-200 flex items-center justify-center text-xs border border-amber-400 flex-shrink-0">ğŸ“œ</div>
                    <div class="bg-white p-3 rounded-lg shadow-sm border border-stone-200 text-stone-800">
                        áƒ›áƒ¨áƒ•áƒ˜áƒ“áƒáƒ‘áƒ áƒ¨áƒ”áƒœáƒ“áƒ, áƒ›áƒ’áƒ–áƒáƒ•áƒ áƒ. áƒ›áƒ” áƒ›áƒ”áƒ¤áƒ” áƒ“áƒáƒ•áƒ˜áƒ—áƒ˜áƒ¡ áƒ™áƒáƒ áƒ˜áƒ¡ áƒ›áƒ”áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ” áƒ•áƒáƒ . áƒ áƒ áƒ’áƒ¡áƒ£áƒ áƒ¡ áƒ˜áƒªáƒáƒ“áƒ” áƒ©áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒáƒ•áƒáƒœáƒ˜ áƒ›áƒ”áƒ¤áƒ˜áƒ¡ áƒáƒœ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ—áƒáƒ•áƒ˜áƒ¡áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘?
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-3 bg-white border-t border-stone-200">
                <div class="flex gap-2">
                    <input type="text" id="chat-input" placeholder="áƒ“áƒáƒ¡áƒ•áƒ˜ áƒ¨áƒ”áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ..." class="flex-grow p-2 border border-stone-300 rounded focus:outline-none focus:border-amber-500 text-sm" onkeypress="handleEnter(event)">
                    <button onclick="sendMessage()" id="send-btn" class="bg-amber-700 hover:bg-amber-600 text-white p-2 rounded transition">
                        â¤
                    </button>
                </div>
            </div>
        </div>

        <!-- Trigger Button -->
        <button onclick="toggleChat()" class="bg-stone-900 hover:bg-stone-800 text-amber-400 p-4 rounded-full shadow-lg border-2 border-amber-500 transition-all hover:scale-110 flex items-center gap-2 group">
            <span class="text-2xl group-hover:animate-pulse">âœ¨</span>
            <span class="font-bold hidden group-hover:inline">áƒ°áƒ™áƒ˜áƒ—áƒ®áƒ” áƒ›áƒ”áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”áƒ¡</span>
        </button>
    </div>

    <!-- Application Logic -->
    <script>
        // --- API Configuration ---
        const apiKey = ""; // Set by environment
        const model = "gemini-2.5-flash-preview-09-2025";

        // --- Data & Charts (Existing) ---
        const timelineData = [
            { year: "1103", title: "áƒ áƒ£áƒ˜áƒ¡-áƒ£áƒ áƒ‘áƒœáƒ˜áƒ¡áƒ˜áƒ¡ áƒ™áƒ áƒ”áƒ‘áƒ", desc: "áƒ”áƒ™áƒšáƒ”áƒ¡áƒ˜áƒ˜áƒ¡ áƒ“áƒ áƒ¡áƒáƒ®áƒ”áƒšáƒ›áƒ¬áƒ˜áƒ¤áƒáƒ¡ áƒ’áƒáƒ«áƒšáƒ˜áƒ”áƒ áƒ”áƒ‘áƒ.", insight: "áƒ¬áƒ”áƒ¡áƒ áƒ˜áƒ’áƒ˜áƒ¡ áƒ“áƒáƒ›áƒ§áƒáƒ áƒ”áƒ‘áƒ." },
            { year: "1118", title: "áƒ§áƒ˜áƒ•áƒ©áƒáƒ¦áƒ—áƒ áƒ’áƒáƒ“áƒ›áƒáƒ¡áƒáƒ®áƒšáƒ”áƒ‘áƒ", desc: "40,000 áƒáƒ¯áƒáƒ®áƒ˜áƒ¡ áƒ©áƒáƒ›áƒáƒ¡áƒáƒ®áƒšáƒ”áƒ‘áƒ áƒ“áƒ áƒ›áƒ£áƒ“áƒ›áƒ˜áƒ•áƒ˜ áƒ¯áƒáƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ.", insight: "áƒ¡áƒáƒ›áƒ®áƒ”áƒ“áƒ áƒ áƒ áƒ”áƒ¡áƒ£áƒ áƒ¡áƒ˜." },
            { year: "1121", title: "áƒ“áƒ˜áƒ“áƒ’áƒáƒ áƒ˜áƒ¡ áƒ‘áƒ áƒ«áƒáƒšáƒ", desc: "áƒ™áƒáƒáƒšáƒ˜áƒªáƒ˜áƒ˜áƒ¡ áƒ’áƒáƒœáƒáƒ“áƒ’áƒ£áƒ áƒ”áƒ‘áƒ.", insight: "áƒ›áƒ¢áƒ áƒ˜áƒ¡ áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒ«áƒáƒšáƒ˜áƒ¡ áƒ’áƒáƒœáƒ”áƒ˜áƒ¢áƒ áƒáƒšáƒ”áƒ‘áƒ." },
            { year: "1122", title: "áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ”áƒ áƒ—áƒ”áƒ‘áƒ", desc: "400 áƒ¬áƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ“áƒ.", insight: "áƒ¡áƒáƒ‘áƒáƒšáƒáƒ áƒ›áƒ˜áƒ–áƒáƒœáƒ˜." }
        ];

        const chronicleContent = `
            <p class="mb-4"><strong class="text-xl block mb-2 text-amber-900">áƒŸáƒáƒ›áƒ¡áƒ áƒ›áƒáƒ¡...</strong> 
            áƒáƒ“áƒ”áƒ¡ áƒ£áƒ¤áƒáƒšáƒ›áƒáƒœ áƒ›áƒáƒ°áƒ®áƒ”áƒ“áƒ áƒ”áƒ áƒ¡áƒ áƒ©áƒ•áƒ”áƒœáƒ¡áƒ áƒ“áƒ áƒ›áƒáƒáƒ•áƒšáƒ˜áƒœáƒ áƒ›áƒ”áƒ¤áƒ” áƒ›áƒ”áƒ¤áƒ”áƒ—áƒ áƒ“áƒáƒ•áƒ˜áƒ—áƒ˜, áƒ«áƒ” áƒ’áƒ˜áƒáƒ áƒ’áƒ˜áƒ¡áƒ˜, áƒ¥áƒ•áƒ”áƒ§áƒáƒœáƒ áƒ¥áƒáƒ áƒ—áƒšáƒ˜áƒ¡áƒ áƒ˜áƒ§áƒ áƒáƒáƒ®áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ â€áƒ“áƒ˜áƒ“áƒ˜ áƒ—áƒ£áƒ áƒ¥áƒáƒ‘áƒ˜áƒ¡áƒâ€œ áƒ“áƒ áƒ£áƒ¡áƒ¯áƒ£áƒšáƒáƒ—áƒ áƒ—áƒáƒ áƒ”áƒ¨áƒ˜áƒ¡áƒ’áƒáƒœ. áƒáƒ áƒáƒ›áƒ”áƒ“ áƒ“áƒáƒ•áƒ˜áƒ—áƒ›áƒ, áƒ•áƒ˜áƒ—áƒáƒ áƒªáƒ áƒ‘áƒ áƒ«áƒ”áƒœáƒ›áƒ áƒ®áƒ£áƒ áƒáƒ—áƒ›áƒáƒ«áƒ¦áƒ•áƒáƒ áƒ›áƒ, áƒ˜áƒ¬áƒ§áƒ áƒ¨áƒ”áƒœáƒ”áƒ‘áƒáƒ˜ áƒ“áƒ áƒ’áƒáƒœáƒ›áƒ¢áƒ™áƒ˜áƒªáƒ”áƒ‘áƒáƒ˜ áƒ¡áƒáƒ›áƒ”áƒ¤áƒáƒ¡áƒ.</p>
            <p class="mb-4"><strong class="text-xl block mb-2 text-amber-900">áƒ¥áƒ áƒáƒœáƒ˜áƒ™áƒáƒœáƒ˜ áƒ˜áƒ§áƒ 441 (1121 áƒ¬áƒ”áƒšáƒ˜)</strong> 
            áƒáƒ“áƒ”áƒ¡ áƒ“áƒ˜áƒ“áƒ’áƒáƒ áƒ˜áƒ¡ áƒ•áƒ”áƒšáƒ–áƒ”, â€áƒ«áƒšáƒ”áƒ•áƒáƒ˜ áƒ¡áƒáƒ™áƒ•áƒ˜áƒ áƒ•áƒ”áƒšáƒ˜áƒ—â€œ áƒ’áƒáƒœáƒ’áƒ•áƒ˜áƒœáƒáƒ—áƒšáƒ áƒ£áƒ¤áƒáƒšáƒ›áƒ áƒ’áƒáƒœáƒ”áƒ‘áƒ áƒ“áƒ áƒ“áƒáƒ•áƒ˜áƒ—áƒ›áƒ, áƒ¡áƒáƒ˜áƒ—áƒ áƒ—áƒ•áƒ˜áƒ¡áƒ˜áƒ—áƒ áƒ“áƒ áƒ§áƒ˜áƒ•áƒ©áƒáƒ¦áƒ—áƒ áƒ—áƒáƒœáƒáƒ“áƒ’áƒáƒ›áƒ˜áƒ—áƒ, áƒ“áƒáƒáƒ›áƒ®áƒ áƒ™áƒáƒáƒšáƒ˜áƒªáƒ˜áƒ áƒ£áƒ áƒ“áƒáƒ”áƒ‘áƒ˜áƒ¡áƒ.</p>
            <p class="mb-4"><strong class="text-xl block mb-2 text-amber-900">áƒ¬áƒ”áƒšáƒ¡áƒ 1122-áƒ¡áƒ, áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ¡áƒ áƒ¨áƒ˜áƒœáƒ</strong> 
            áƒ›áƒ˜áƒáƒ“áƒ’áƒ áƒ›áƒ”áƒ¤áƒ” áƒ“áƒáƒ•áƒ˜áƒ—áƒ˜ áƒ¥áƒáƒšáƒáƒ¥áƒ¡áƒ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ¡, áƒ áƒáƒ›áƒ”áƒšáƒ¡áƒáƒª áƒáƒ—áƒ®áƒáƒ¡ áƒ¬áƒ”áƒšáƒ–áƒ” áƒ›áƒ”áƒ¢áƒ˜áƒ, áƒ£áƒªáƒ®áƒ áƒ¢áƒáƒ›áƒœáƒ˜ áƒ¤áƒšáƒáƒ‘áƒ“áƒœáƒ”áƒœ. áƒ›áƒ¢áƒ™áƒ˜áƒªáƒ” áƒ˜áƒ§áƒ áƒ’áƒáƒšáƒáƒ•áƒáƒœáƒ˜ áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡áƒ, áƒ›áƒáƒ’áƒ áƒáƒ› áƒ£áƒ¤áƒ áƒ áƒ›áƒ¢áƒ™áƒ˜áƒªáƒ” áƒ˜áƒ§áƒ áƒœáƒ”áƒ‘áƒ áƒ›áƒ”áƒ¤áƒ˜áƒ¡áƒ.</p>
        `;

        // --- AI Helper Functions ---
        
        async function callGemini(systemInstruction, userPrompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });

                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error(error);
                return "áƒ‘áƒáƒ“áƒ˜áƒ¨áƒ˜, áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ áƒ’áƒáƒ¬áƒ§áƒ“áƒ. áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¡áƒªáƒáƒ“áƒáƒ— áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ.";
            }
        }

        // --- Feature 1: Chronicle Generator ---
        
        async function generateChronicle() {
            const input = document.getElementById('chronicle-input').value;
            const outputDiv = document.getElementById('chronicle-output');
            const btn = document.getElementById('chronicle-btn');

            if (!input.trim()) return;

            // UI Loading State
            btn.innerHTML = `<span class="sparkle-anim">âœ¨</span> áƒ˜áƒ¬áƒ”áƒ áƒ”áƒ‘áƒ...`;
            btn.disabled = true;
            outputDiv.classList.remove('hidden');
            outputDiv.innerHTML = "<em>áƒ›áƒ”áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ” áƒ¤áƒ˜áƒ¥áƒ áƒáƒ‘áƒ¡...</em>";

            const systemPrompt = `
                You are a medieval Georgian chronicler (12th century). Continue the text provided by the user.
                Style: Archaic, dignified, praising King David IV and God. Use Old Georgian flavor but modern script.
                Context: The capture of Tbilisi (1122) and the unification of Georgia.
                Keep it short (2-3 sentences).
                Output language: Georgian.
            `;

            const text = await callGemini(systemPrompt, input);

            outputDiv.innerHTML = marked.parse(text);
            btn.innerHTML = `<span>âœï¸</span> áƒ¨áƒ”áƒ—áƒ®áƒ–áƒ” áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ”`;
            btn.disabled = false;
        }

        // --- Feature 2: Historian Chat ---

        let chatOpen = false;

        function toggleChat() {
            const modal = document.getElementById('chat-modal');
            chatOpen = !chatOpen;
            if (chatOpen) {
                modal.classList.remove('hidden');
                modal.classList.add('chat-enter-active');
                setTimeout(() => document.getElementById('chat-input').focus(), 300);
            } else {
                modal.classList.add('hidden');
            }
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const messages = document.getElementById('chat-messages');
            const userText = input.value;
            if (!userText.trim()) return;

            // Add User Message
            messages.innerHTML += `
                <div class="flex gap-2 justify-end">
                    <div class="bg-amber-600 text-white p-3 rounded-lg shadow-sm max-w-[80%]">
                        ${userText}
                    </div>
                </div>
            `;
            input.value = '';
            messages.scrollTop = messages.scrollHeight;

            // Show Loading
            const loadingId = 'loading-' + Date.now();
            messages.innerHTML += `
                <div id="${loadingId}" class="flex gap-2">
                    <div class="w-8 h-8 rounded-full bg-amber-200 flex items-center justify-center text-xs border border-amber-400 flex-shrink-0">ğŸ“œ</div>
                    <div class="bg-white p-3 rounded-lg shadow-sm border border-stone-200 text-stone-500 italic">
                        áƒ›áƒ”áƒ›áƒáƒ¢áƒ˜áƒáƒœáƒ” áƒ”áƒ«áƒ”áƒ‘áƒ¡ áƒáƒáƒ¡áƒ£áƒ®áƒ¡...
                    </div>
                </div>
            `;
            messages.scrollTop = messages.scrollHeight;

            // Call API
            const systemPrompt = `
                Role: Royal Historian of King David IV the Builder (12th century Georgia).
                Tone: Wise, archaic (using terms like "áƒŸáƒáƒ›áƒ¡áƒ áƒ›áƒáƒ¡", "áƒ®áƒ”áƒšáƒ›áƒ¬áƒ˜áƒ¤áƒ”"), respectful, patriotic.
                Topics: Battle of Didgori, Capture of Tbilisi, Reforms (Military, Church), Tolerance.
                Instructions: Answer the user's question accurately but maintain the persona. Keep answers concise (max 3 sentences).
                Language: Georgian.
            `;

            const reply = await callGemini(systemPrompt, userText);

            // Replace Loading with Reply
            document.getElementById(loadingId).remove();
            messages.innerHTML += `
                <div class="flex gap-2">
                    <div class="w-8 h-8 rounded-full bg-amber-200 flex items-center justify-center text-xs border border-amber-400 flex-shrink-0">ğŸ“œ</div>
                    <div class="bg-white p-3 rounded-lg shadow-sm border border-stone-200 text-stone-800">
                        ${marked.parse(reply)}
                    </div>
                </div>
            `;
            messages.scrollTop = messages.scrollHeight;
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('chronicle-text').innerHTML = chronicleContent;
            
            // Init Timeline (Simplified for brevity)
            const navContainer = document.getElementById('timeline-nav');
            timelineData.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = `w-full text-left pl-6 py-3 border-l-4 transition hover:bg-stone-200 ${index === 0 ? 'border-amber-600 bg-stone-100' : 'border-transparent text-stone-500'}`;
                btn.onclick = () => {
                    document.getElementById('tl-title').textContent = item.title;
                    document.getElementById('tl-desc').textContent = item.desc;
                    document.getElementById('tl-insight').textContent = item.insight;
                };
                btn.innerHTML = `<span class="font-bold">${item.year}</span> <span class="text-sm block">${item.title}</span>`;
                navContainer.appendChild(btn);
            });

            // Init Charts
            renderCharts();
        });

        function renderCharts() {
            Chart.defaults.font.family = "'Noto Sans Georgian', sans-serif";
            new Chart(document.getElementById('armyChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['áƒ§áƒ˜áƒ•áƒ©áƒáƒ¦áƒ”áƒ‘áƒ˜', 'áƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ”áƒ‘áƒ˜', 'áƒ¡áƒ®áƒ•áƒ'],
                    datasets: [{ data: [40000, 15000, 600], backgroundColor: ['#d97706', '#b91c1c', '#4b5563'] }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });

            new Chart(document.getElementById('battleChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['áƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ”áƒ‘áƒ˜', 'áƒ™áƒáƒáƒšáƒ˜áƒªáƒ˜áƒ'],
                    datasets: [{ label: 'áƒ¯áƒáƒ áƒ˜', data: [56000, 250000], backgroundColor: ['#059669', '#991b1b'] }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        }
    </script>
</body>
</html>